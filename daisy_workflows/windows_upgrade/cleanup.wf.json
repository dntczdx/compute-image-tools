{
  "Name": "cleanup",
  "DefaultTimeout": "5m",
  "Vars": {
    "instance": {
      "Required": true,
      "Description": "instance uri"
    },
    "project": {
      "Required": true,
      "Description": "project of the instance"
    },
    "zone": {
      "Required": true,
      "Description": "zone of the instance"
    },
    "original_startup_script_url": {
      "Value": "",
      "Description": "original startup script url"
    },
    "install_media": {
      "Required": true,
      "Description": "install media disk name"
    }
  },
  "Steps": {
    "restore-script": {
      "UpdateInstancesMetadata": [
        {
          "Instance": "${instance}",
          "Metadata": {
            "windows-startup-script-url": "${original_startup_script_url}"
          }
        }
      ]
    },
    "detach-install-media-disk": {
      "DetachDisks": [
        {
          "Instance": "${instance}",
          "DeviceName": "projects/${project}/zones/${zone}/devices/${install_media}"
        }
      ]
    },
    "delete-install-media-disk": {
      "DeleteResources": {
        "Disks": [
          "projects/${project}/zones/${zone}/disks/${install_media}"
        ]
      }
    }
  },
  "Dependencies": {
    "delete-install-media-disk": ["detach-install-media-disk"]
  }
}
